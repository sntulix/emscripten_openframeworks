name: emscripten_build

# Run this workflow every time a new commit pushed to your repository
on: push

jobs:
  # Set the job key. The key is displayed as the job name
  # when a job name is not provided
  emscripten_build:
    # Name the Job
    name: emscripten build
    # Set the type of machine to run on
    runs-on: ubuntu-latest

    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: show uname
        run: uname -a

#      - name: symbolic link python2
#        run: sudo ln -s /usr/bin/python2 /usr/bin/python

      - name: update apt
        run: sudo apt update

      - name: install base packages
        run: sudo apt-get install git gcc g++ cmake wget unzip

      - name: cd
        run: cd ~

      - name: Checkout other repo
        uses: actions/checkout@v2
        with:
          repository: emscripten-core/emsdk
          path: emsdk

      - name: ls
        run: ls
        working-directory: ./emsdk

      - name: emscripten install
        run: ./emsdk install 1.39.4-fastcomp # https://github.com/constantdupuis/of_docker
        working-directory: ./emsdk

      - name: emscripten activate a version
        run: ./emsdk activate 1.39.4-fastcomp # https://github.com/constantdupuis/of_docker
        working-directory: ./emsdk

      - name: emscripten set PATH
        run: source "./emsdk_env.sh" && emcc --clear-cache
        working-directory: ./emsdk

      - name: cd
        run: cd ~

      - name: openFrameworks download
        run: wget https://github.com/openframeworks/openFrameworks/archive/0.11.0.zip

      - name: openFrameworks download
        run: unzip -q 0.11.0.zip

      - name: ls
        run: ls
        working-directory: ./openFrameworks-0.11.0

      - name: openFrameworks download libs
        run: scripts/emscripten/./download_libs.sh
        working-directory: ./openFrameworks-0.11.0

      - name: openFrameworks copy a Makefile
        run: cp ../../../scripts/templates/emscripten/Makefile .
        working-directory: ./openFrameworks-0.11.0/examples/3d/3DPrimitivesExample

      - name: openFrameworks build sample
        run: ~/emsdk/emscripten/1.38.9/emmake make
        working-directory: ./openFrameworks-0.11.0/examples/3d/3DPrimitivesExample

      - name: ls
        run: ls
        working-directory: ./openFrameworks-0.11.0/examples/3d/3DPrimitivesExample

      - name: ls
        run: ls
        working-directory: ./openFrameworks-0.11.0/examples/3d/3DPrimitivesExample/bin
